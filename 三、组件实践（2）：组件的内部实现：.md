# ä¸‰ã€ç»„ä»¶å®è·µï¼ˆ2ï¼‰ï¼šç»„ä»¶çš„å†…éƒ¨å®ç°ï¼š

### 1.æ„å»º StopWatchï¼š

```javascript
import React, {Component,Fragment} from 'react';
import MajorClock from '../MajorClock/MajorClock';
import ControlButtons from '../ControlButtons/ControlButtons';
import SplitTimes from '../SplitTimes/SplitTimes';

class StopWatch extends Component {
    constructor() {
        super(...arguments);
        this.state = {
            isStarted: false,
            startTime: null,
            currentTime: null,
            splits: []
        };
    }
    render() {
        return (
            <Fragment>
                <MajorClock milliseconds={this.state.currentTime - this.state.startTime}/>
                <ControlButtons 
                activated={this.state.isStarted}      //ç›‘æµ‹æ˜¯å¦å¼€å¯äº†ç§’è¡¨â±
                onStart={this.onStart}
                onPause={this.onPause}
                onReset={this.onReset}
                onSplit={this.onSplit}
                />
                <SplitTimes value={this.state.splits} />
            </Fragment>
        );
    }
    //è®¡æ¬¡ğŸ“”
    onSplit = () => {
        this.setState({
          splits: [...this.state.splits, this.state.currentTime - this.state.startTime]
        });
      }
    //å¼€å§‹ğŸ“•
    onStart = () => {
        this.setState({
          isStarted: true,
          startTime: new Date(),
          currentTime: new Date(),
        });
                 //ğŸ’¡è¿™ä¸ªåœ°æ–¹æ˜¯éœ€è¦é€šè¿‡è®¡æ—¶å™¨ä¸æ–­åœ°æ›´æ–°
        this.intervalHandle = setInterval(() => {
          this.setState({currentTime: new Date()});
        }, 1000 / 60);
      }
    //æš‚åœğŸ“—
      onPause = () => {
        clearInterval(this.intervalHandle);
        this.setState({
          isStarted: false,
        });
      }
    //å¤ä½ğŸ“˜
      onReset = () => {
        this.setState({
          startTime: null,
          currentTime: null,
          splits: [],
        });
      }
}

export default StopWatch;

```



### 2.æ¥ä¸‹æ¥çœ‹ä¸‹MajorClock.jsçš„ä»£ç ï¼š

```javascript
import React from 'react';
import padStart from "lodash/padStart";
import PropTypes from "prop-types";
//å¼•å…¥lodashå¯¹æ—¶é—´è¿›è¡Œ0è¡¥ä½çš„å¤„ç†
const ms2Time = (milliseconds) => {
    let time = milliseconds;
    const ms = milliseconds % 1000;
    time = (milliseconds - ms) / 1000;
    const seconds = time % 60;
    time = (time - seconds) / 60;
    const minutes = time % 60;
    const hours = (time - minutes) / 60;
  
    const result = padStart(hours, 2, '0') + ":" + padStart(minutes, 2, '0') + ":" + padStart(seconds, 2, '0') + "." + padStart(ms, 3, '0');
    return result;
  }


const MajorClock = ({milliseconds}) => {
    return <h1>{ms2Time(milliseconds)}</h1>
  };
  
  MajorClock.propTypes = {
    milliseconds: PropTypes.number.isRequired
  };
  export default MajorClock;
```

- å…³äºlodashçš„å­¦ä¹ ï¼šhttps://www.lodashjs.com/docs/latest#_padstartstring-length0-chars



### 3.ControlButtonsæŒ‰é’®ç»„ä»¶ï¼š

```javascript
import React from 'react';
import PropTypes from "prop-types";

const ControlButtons = ({activated, onStart, onPause, onReset, onSplit}) => { //è§£æ„èµ‹å€¼
  
    // const {activated, onStart, onPause, onReset, onSplit} = props;
  
    if (activated) {     //âœ¨é€šè¿‡activatedæ¥åˆ¤æ–­æŒ‰é’®çš„æ˜¾ç¤ºæƒ…å†µ
      return (
        <div>
          <button onClick={onSplit}>è®¡æ¬¡</button>
          <button onClick={onPause}>åœæ­¢</button>
        </div>
      );
    } else {
      return (
        <div>
          <button onClick={onReset}>å¤ä½</button>
          <button onClick={onStart}>å¯åŠ¨</button>
        </div>
      );
    }
  };
  
  ControlButtons.propTypes = {
    activated: PropTypes.bool,
    onStart: PropTypes.func.isRquired,
    onPause: PropTypes.func.isRquired,
    onSplit: PropTypes.func.isRquired,
    onReset: PropTypes.func.isRquired,
  };

  export default ControlButtons;
```



### 4.SplitTimesè®¡æ¬¡åˆ—è¡¨ç»„ä»¶ï¼š

```javascript
import React from 'react';
import MajorClock from '../MajorClock/MajorClock';
import PropTypes from "prop-types";


const SplitTimes = ({value=[]}) => {   
    return value.map((v, k) => (
      <MajorClock key={k} milliseconds={v} />
    ));
  };
  
  SplitTimes.propTypes = {
    splits: PropTypes.arrayOf(PropTypes.number)
  };

  export default SplitTimes;
```



å¼€å‘æŠ€å·§ğŸ–Œï¼š

- å°½é‡æ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±ä¸“å±çš„æºä»£ç æ–‡ä»¶ï¼›
- ç”¨**è§£æ„èµ‹å€¼**çš„æ–¹æ³•è·å–å‚æ•° props çš„æ¯ä¸ªå±æ€§å€¼ï¼›
- åˆ©ç”¨**å±æ€§åˆå§‹åŒ–**æ¥å®šä¹‰ state å’Œæˆå‘˜å‡½æ•°ã€‚





### ğŸŒ»ğŸŒ»é‚£äº›å‡ºç¥å…¥åŒ–çš„ç†è§£ğŸ‰ï¼šå¯¹ï¼Œæ²¡æœ‰é”™ï¼Œä½ å¾—çŸ¥é“

#### 1.Reactå®˜æ–¹ç½‘ç«™ä¸Šçš„ä»£ç ç¤ºä¾‹æ˜¯è¿™æ ·è°ƒç”¨superå‡½æ•°ï¼š

```javascript
  constructor(props) {
    super(props); //ç›®å‰å¯è¡Œï¼Œä½†æœ‰æ›´å¥½çš„æ–¹æ³•
  }
```

åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼ŒReact.Component çš„æ„é€ å‡½æ•°å‚æ•°æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªæ˜¯ `props`ï¼Œç¬¬äºŒä¸ªæ˜¯ `context`ï¼Œå¦‚æœå¿½ç•¥æ‰ `context` å‚æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªç»„ä»¶çš„ context åŠŸèƒ½å°±ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œä¸è¿‡ï¼Œç°åœ¨Reactçš„è¡Œä¸ºå·²ç»å˜äº†ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ä¸ä¼ é€’éƒ½èƒ½è®©contextæ­£å¸¸å·¥ä½œï¼Œçœ‹èµ·æ¥React.Component çš„æ„é€ å‡½æ•°åªæœ‰ç¬¬ä¸€ä¸ªå‚æ•°è¢«ç”¨åˆ°ï¼Œä½†æ˜¯ï¼Œæ²¡å‡†æœªæ¥è¿˜ä¼šå¢åŠ æ–°çš„å‚æ•°å‘¢ï¼Œæ‰€ä»¥ï¼Œä»¥ä¸å˜åº”ä¸‡å˜çš„æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨æ‰©å±•æ“ä½œç¬¦ï¼ˆspread operatorï¼‰æ¥å±•å¼€ argumentsï¼Œè¿™æ ·ä¸ç®¡ React å°†æ¥æ€ä¹ˆå˜ï¼Œè¿™æ ·çš„ä»£ç éƒ½æ­£ç¡®ã€‚

```javascript
  constructor() {
    super(...arguments); //æ°¸è¿œæ­£ç¡®ï¼
  }
```



#### 2.å°½é‡ä¸è¦åœ¨ JSX ä¸­å†™å†…è”å‡½æ•°ï¼ˆinline functionï¼‰ï¼Œæ¯”å¦‚è¿™æ ·å†™ï¼Œæ˜¯å¾ˆä¸æ°å½“çš„ï¼š

```javascript
  <ControlButtons
          activated={this.state.isStarted}
          onStart={() => { /* TODO */}}
          onPause={() => { /* TODO */}}
          onReset={() => { /* TODO */}}
          onSplit={() => { /* TODO */}}
        />
```

ğŸŒµç¼ºç‚¹ï¼š

- æ¯ä¸€æ¬¡æ¸²æŸ“è¿™æ®µ JSXï¼Œéƒ½ä¼šäº§ç”Ÿ**å…¨æ–°çš„å‡½æ•°å¯¹è±¡**ï¼Œè¿™æ˜¯ä¸€ç§æµªè´¹
- æ¯ä¸€æ¬¡ä¼ ç»™ ControlButtons çš„éƒ½æ˜¯æ–°çš„ propsï¼Œè¿™æ · ControlButtons ä¹Ÿæ— æ³•é€šè¿‡ `shouldComponentUpdate` å¯¹ props çš„æ£€æŸ¥æ¥é¿å…é‡å¤æ¸²æŸ“